# مراجعة دورة حياة طلب الصيانة

يوضح هذا المستند مراحل طلب الصيانة من لحظة إنشائه حتى الإغلاق والأرشفة، مع نقاط التحكم المطلوبة لضمان التتبع، الشفافية، والجودة.

## المسار الطبيعي (من البداية إلى الأرشفة)
1. **إنشاء الطلب (Draft/Submitted)**
   - إدخال بيانات العقار، نوع المشكلة، الأولوية، ووسيلة الاتصال.
   - التحقق الآلي من الحقول الإلزامية وحجز رقم طلب فوري.
2. **المراجعة الإدارية (Under Review)**
   - فحص التكرار ووجود طلبات مفتوحة لنفس الأصل/العقار.
   - إما **اعتماد** الطلب أو **رفضه** مع سبب واضح.
3. **الموافقة والتعيين (Approved → Assigned)**
   - اختيار فني مؤهل بناءً على التخصص والنطاق الجغرافي والتوفر.
   - إرسال إشعار للفني يتضمن SLA والموعد المستهدف.
4. **قبول الفني والجدولة (Accepted → Scheduled)**
   - الفني يؤكد استلامه ثم يقترح موعد زيارة.
   - العميل/المشرف يعتمد الجدولة مع نافذة زمنية واضحة.
5. **التنفيذ في الموقع (In Progress)**
   - بدء العمل بعد تسجيل وقت الوصول.
   - في حال الحاجة لمواد إضافية يتم رفع طلب موافقة سريع (Materials Needed → Materials Approved).
6. **الفحص والجودة (Pending Inspection → Inspection Passed)**
   - فحص داخلي أو من العميل للتحقق من الحل.
   - توثيق صور/مرفقات قبل/بعد وإغلاق أي ملاحظات مفتوحة.
7. **الإكمال والفوترة (Completed → Billed)**
   - تأكيد الإكمال مع ملخص الأعمال وقطع الغيار.
   - إصدار فاتورة وتثبيت المبالغ والضرائب وأي خصومات.
8. **الدفع والإغلاق (Paid → Closed)**
   - تسجيل الدفع (نقدي/إلكتروني) وربطه بالفاتورة والطلب.
   - إغلاق الطلب مع ختم زمني للمسؤول الذي أغلقه.
9. **الأرشفة (Archived)**
   - نقل الطلب إلى حالة الأرشفة بعد التأكد من عدم وجود التزامات مفتوحة.
   - الاحتفاظ بالسجل للرجوع التاريخي والتقارير.

## حالات استثنائية يجب دعمها
- **إيقاف مؤقت (On Hold):** توثيق السبب وتاريخ إعادة التقييم المتوقع.
- **مواد إضافية مطلوبة:** موافقة العميل على التكلفة/الزمن قبل استئناف العمل.
- **إلغاء أو رفض:** تسجيل السبب، من قام بالإلغاء، وتوقيت الحدث، مع السماح بالأرشفة اللاحقة.
- **إعادة العمل بعد فحص فاشل:** الرجوع تلقائياً إلى In Progress مع الاحتفاظ بسجل الفحص الفاشل والملاحظات.

## نقاط بيانات أساسية لكل مرحلة
- الطابع الزمني للانتقال بين المراحل، وهوية من قام بالإجراء.
- الملاحظات والمرفقات (صور، تقارير فحص، توقيعات رقمية).
- التكاليف المتراكمة، ساعات العمل، وقطع الغيار المستخدمة.
- إشعارات مرسلة (عميل، فني، إدارة) وحالتها.
- حالة الالتزام بالـSLA (الاستجابة، الوصول، الإكمال).

## توصيات قابلة للتنفيذ
- **خرائط انتقال واضحة:** تأكد من أن واجهة "دورة حياة الطلب" (RequestLifecycleJourney.tsx) تعرض كل المسارات الطبيعية والاستثنائية بنفس التسميات في قاعدة البيانات.
- **تحقق مزدوج قبل الأرشفة:** منع الأرشفة ما لم تكن الفاتورة مدفوعة، ولا توجد طلبات مواد معلقة، وجميع الفحوصات ناجحة.
- **تدقيق كامل:** سجّل كل انتقال حالة مع المستخدم، الوقت، وسبب التحويل، واجعله قابلاً للتصدير.
- **إشعارات موحدة:** اربط كل حالة رئيسية برسائل SMS/WhatsApp/Email موحدة (استلام، تعيين، جدولة، بدء، مواد إضافية، فحص، إكمال، فوترة، إغلاق).
- **تقارير SLA:** أضف لوحة تعقب زمني تظهر متوسطات (زمن الاستجابة، زمن الوصول، زمن الإكمال) لكل نوع صيانة وفريق.
- **بوابة الموافقات:** وفّر شاشة موحدة للموافقات (إجراءات تحت المراجعة، مواد إضافية، فواتير) مع أدوار وصلاحيات واضحة.
- **حماية ضد التكرار:** عند إنشاء طلب جديد، تحقق من الطلبات المفتوحة لنفس العقار/الأصل لمنع الازدواجية.

هذا المستند مكمل لواجهة "دورة حياة طلب الصيانة الكاملة" الحالية، ويحدد نقاط التحكم التي يجب مراقبتها لضمان اكتمال السجل من الإنشاء إلى الأرشفة.
